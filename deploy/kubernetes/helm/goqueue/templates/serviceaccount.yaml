{{- if .Values.serviceAccount.create -}}
# =============================================================================
# GOQUEUE SERVICE ACCOUNT
# =============================================================================
#
# ServiceAccount provides an identity for pods to interact with the Kubernetes API.
#
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ WHY SERVICE ACCOUNT?                                                        │
# │                                                                             │
# │ 1. Identity for K8s API access (if needed for leader election, etc.)        │
# │ 2. IAM integration on cloud providers:                                      │
# │    - AWS: IRSA (IAM Roles for Service Accounts)                             │
# │    - GCP: Workload Identity                                                 │
# │    - Azure: Azure AD Pod Identity                                           │
# │                                                                             │
# │ Example: GoQueue might need to access S3/GCS for tiered storage             │
# │ Instead of hardcoding credentials, use cloud IAM integration.               │
# └─────────────────────────────────────────────────────────────────────────────┘
#
apiVersion: v1
kind: ServiceAccount
metadata:
  name: {{ include "goqueue.serviceAccountName" . }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "goqueue.labels" . | nindent 4 }}
  {{- with .Values.serviceAccount.annotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
automountServiceAccountToken: true
{{- end }}
